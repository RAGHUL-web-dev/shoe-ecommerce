<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARCHIVE - SOLE JOURNAL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        .font-inter { font-family: 'Inter', sans-serif; }
        .tracking-ultra { letter-spacing: 0.3em; }
        .tracking-mega { letter-spacing: 0.5em; }
        .text-neon { color: #00ff88; }
        .bg-neon { background-color: #00ff88; }
        .border-neon { border-color: #00ff88; }
        .text-micro { font-size: 0.7rem; }
        .loading-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .filter-section {
            transition: all 0.3s ease;
        }
        
        .filter-option {
            transition: all 0.2s ease;
        }
        
        .filter-option:hover {
            transform: translateX(4px);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="font-inter bg-white text-black antialiased">
    <!-- Navigation Container -->
    <div id="navbar-container"></div>

    <!-- Products Header -->
    <section class="bg-black text-white border-b-4 border-white">
        <div class="container mx-auto px-4 py-20">
            <div class="flex items-center space-x-4 mb-4">
                <div class="w-12 h-1 bg-neon"></div>
                <span class="text-micro tracking-mega uppercase text-gray-400">PRODUCT ARCHIVE</span>
            </div>
            <h1 class="text-6xl md:text-7xl font-black uppercase">THE<br>ARCHIVE</h1>
            <p class="text-xl tracking-wider uppercase text-gray-300 mt-4">CURATED SELECTION OF PREMIUM FOOTWEAR</p>
        </div>
    </section>

    <!-- Featured Collections Banner -->
    <section class="py-12 bg-gray-100">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-end mb-8 border-b-2 border-black pb-4">
                <div>
                    <div class="flex items-center space-x-4 mb-2">
                        <div class="w-8 h-1 bg-neon"></div>
                        <span class="text-micro tracking-mega uppercase text-gray-500">FEATURED COLLECTIONS</span>
                    </div>
                    <h2 class="text-3xl font-black uppercase">TRENDING NOW</h2>
                </div>
                <a href="collections.html" class="text-sm tracking-ultra uppercase hover:text-neon transition duration-300 border-b-2 border-black hover:border-neon pb-1">
                    VIEW ALL →
                </a>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <!-- Collection 1 -->
                <div class="card-hover group relative bg-black text-white overflow-hidden h-80">
                    <img src="https://images.unsplash.com/photo-1549298916-b41d501d3772?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1412&q=80"
                         alt="Running Collection"
                         class="w-full h-full object-cover group-hover:scale-110 transition duration-700 opacity-70">
                    <div class="absolute inset-0 flex flex-col justify-end p-6">
                        <h3 class="text-2xl font-bold uppercase mb-2">RUNNING ESSENTIALS</h3>
                        <p class="text-gray-300 mb-4">Performance footwear for every stride</p>
                        <a href="products.html?category=running" class="text-neon font-bold tracking-wider uppercase text-sm border-b-2 border-neon pb-1 inline-block">
                            SHOP COLLECTION →
                        </a>
                    </div>
                </div>
                
                <!-- Collection 2 -->
                <div class="card-hover group relative bg-black text-white overflow-hidden h-80">
                    <img src="https://images.unsplash.com/photo-1600185365483-26d7a4cc7519?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1450&q=80"
                         alt="Lifestyle Collection"
                         class="w-full h-full object-cover group-hover:scale-110 transition duration-700 opacity-70">
                    <div class="absolute inset-0 flex flex-col justify-end p-6">
                        <h3 class="text-2xl font-bold uppercase mb-2">URBAN LIFESTYLE</h3>
                        <p class="text-gray-300 mb-4">Street-ready styles for everyday wear</p>
                        <a href="products.html?category=lifestyle" class="text-neon font-bold tracking-wider uppercase text-sm border-b-2 border-neon pb-1 inline-block">
                            SHOP COLLECTION →
                        </a>
                    </div>
                </div>
                
                <!-- Collection 3 -->
                <div class="card-hover group relative bg-black text-white overflow-hidden h-80">
                    <img src="https://images.unsplash.com/photo-1606107557195-0e29a4b5b4aa?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1364&q=80"
                         alt="Limited Edition Collection"
                         class="w-full h-full object-cover group-hover:scale-110 transition duration-700 opacity-70">
                    <div class="absolute inset-0 flex flex-col justify-end p-6">
                        <h3 class="text-2xl font-bold uppercase mb-2">LIMITED EDITIONS</h3>
                        <p class="text-gray-300 mb-4">Exclusive drops and collaborations</p>
                        <a href="products.html?category=limited" class="text-neon font-bold tracking-wider uppercase text-sm border-b-2 border-neon pb-1 inline-block">
                            SHOP COLLECTION →
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <section class="py-12">
        <div class="container mx-auto px-4">
            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Filters Sidebar -->
                <div class="lg:w-1/4 space-y-8">
                    <!-- Search Filter -->
                    <div class="filter-section border-2 border-black p-6">
                        <h3 class="text-lg font-black uppercase mb-4">SEARCH</h3>
                        <div class="relative">
                            <input type="text" 
                                   id="search-filter"
                                   placeholder="ENTER KEYWORDS..."
                                   class="w-full px-4 py-3 bg-transparent border-2 border-black text-black placeholder-gray-500 tracking-wider uppercase focus:outline-none focus:border-neon transition duration-300">
                            <button onclick="applyFilters()" class="absolute right-3 top-3 text-black hover:text-neon transition duration-300">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Brand Filter -->
                    <div class="filter-section border-2 border-black p-6">
                        <h3 class="text-lg font-black uppercase mb-4">BRANDS</h3>
                        <div id="brands-filter" class="space-y-2 max-h-60 overflow-y-auto">
                            <!-- Brands will be loaded here -->
                            <div class="loading-pulse bg-gray-200 h-6"></div>
                            <div class="loading-pulse bg-gray-200 h-6"></div>
                            <div class="loading-pulse bg-gray-200 h-6"></div>
                        </div>
                    </div>

                    <!-- Size Filter -->
                    <div class="filter-section border-2 border-black p-6">
                        <h3 class="text-lg font-black uppercase mb-4">SIZES</h3>
                        <div class="grid grid-cols-4 gap-2" id="sizes-filter">
                            <!-- Sizes will be generated here -->
                        </div>
                    </div>

                    <!-- Price Filter -->
                    <div class="filter-section border-2 border-black p-6">
                        <h3 class="text-lg font-black uppercase mb-4">PRICE RANGE</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between text-sm tracking-wider uppercase">
                                <span>₹<span id="min-price">0</span></span>
                                <span>₹<span id="max-price">50000</span></span>
                            </div>
                            <input type="range" 
                                   id="price-range" 
                                   min="0" 
                                   max="50000" 
                                   value="50000"
                                   class="w-full h-1 bg-black rounded-lg appearance-none cursor-pointer">
                        </div>
                    </div>

                    <!-- Rating Filter -->
                    <div class="filter-section border-2 border-black p-6">
                        <h3 class="text-lg font-black uppercase mb-4">RATINGS</h3>
                        <div id="ratings-filter" class="space-y-2">
                            <!-- Rating options will be generated here -->
                        </div>
                    </div>

                    <!-- Clear Filters -->
                    <button onclick="clearFilters()" class="w-full border-2 border-black text-black py-3 font-bold tracking-wider uppercase hover:bg-black hover:text-white transition duration-300">
                        CLEAR FILTERS
                    </button>
                </div>

                <!-- Products Grid -->
                <div class="lg:w-3/4">
                    <!-- Products Header -->
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 border-b-2 border-black pb-4">
                        <div>
                            <p class="text-micro tracking-wider uppercase text-gray-500" id="products-count">LOADING PRODUCTS...</p>
                            <h2 class="text-2xl font-black uppercase">CURATED SELECTION</h2>
                        </div>
                        
                        <!-- Sort Options -->
                        <div class="mt-4 md:mt-0">
                            <select id="sort-options" onchange="applyFilters()" 
                                    class="bg-transparent border-2 border-black px-4 py-2 tracking-wider uppercase focus:outline-none focus:border-neon transition duration-300">
                                <option value="-createdAt">NEWEST FIRST</option>
                                <option value="createdAt">OLDEST FIRST</option>
                                <option value="basePrice">PRICE: LOW TO HIGH</option>
                                <option value="-basePrice">PRICE: HIGH TO LOW</option>
                                <option value="-rating.average">TOP RATED</option>
                                <option value="name">NAME: A-Z</option>
                                <option value="-name">NAME: Z-A</option>
                            </select>
                        </div>
                    </div>

                    <!-- Products Grid -->
                    <div id="products-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
                        <!-- Products will be loaded here -->
                        <div class="loading-pulse bg-gray-200 h-96"></div>
                        <div class="loading-pulse bg-gray-200 h-96"></div>
                        <div class="loading-pulse bg-gray-200 h-96"></div>
                        <div class="loading-pulse bg-gray-200 h-96"></div>
                        <div class="loading-pulse bg-gray-200 h-96"></div>
                        <div class="loading-pulse bg-gray-200 h-96"></div>
                    </div>

                    <!-- Pagination -->
                    <div id="pagination" class="flex justify-center items-center space-x-4 border-t-2 border-black pt-8">
                        <!-- Pagination will be generated here -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Featured Brands Section -->
    <section class="py-16 bg-black text-white">
        <div class="container mx-auto px-4">
            <div class="text-center mb-12">
                <div class="flex items-center justify-center space-x-4 mb-4">
                    <div class="w-12 h-1 bg-neon"></div>
                    <span class="text-micro tracking-mega uppercase text-gray-400">FEATURED BRANDS</span>
                    <div class="w-12 h-1 bg-neon"></div>
                </div>
                <h2 class="text-4xl md:text-5xl font-black uppercase">PREMIUM<br><span class="text-neon">PARTNERSHIPS</span></h2>
            </div>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                <!-- Brand 1 -->
                <div class="text-center group">
                    <div class="bg-white p-8 mb-4 group-hover:bg-neon transition duration-300">
                        <img src="https://logos-world.net/wp-content/uploads/2020/04/Nike-Logo.png" 
                             alt="Nike" 
                             class="h-12 mx-auto grayscale group-hover:grayscale-0 transition duration-300">
                    </div>
                    <h3 class="text-lg font-bold uppercase mb-2">NIKE</h3>
                    <p class="text-gray-400 text-sm">Just Do It</p>
                </div>
                
                <!-- Brand 2 -->
                <div class="text-center group">
                    <div class="bg-white p-8 mb-4 group-hover:bg-neon transition duration-300">
                        <img src="https://logos-world.net/wp-content/uploads/2020/04/Adidas-Logo.png" 
                             alt="Adidas" 
                             class="h-12 mx-auto grayscale group-hover:grayscale-0 transition duration-300">
                    </div>
                    <h3 class="text-lg font-bold uppercase mb-2">ADIDAS</h3>
                    <p class="text-gray-400 text-sm">Impossible is Nothing</p>
                </div>
                
                <!-- Brand 3 -->
                <div class="text-center group">
                    <div class="bg-white p-8 mb-4 group-hover:bg-neon transition duration-300">
                        <img src="https://logos-world.net/wp-content/uploads/2020/04/Puma-Logo.png" 
                             alt="Puma" 
                             class="h-12 mx-auto grayscale group-hover:grayscale-0 transition duration-300">
                    </div>
                    <h3 class="text-lg font-bold uppercase mb-2">PUMA</h3>
                    <p class="text-gray-400 text-sm">Forever Faster</p>
                </div>
                
                <!-- Brand 4 -->
                <div class="text-center group">
                    <div class="bg-white p-8 mb-4 group-hover:bg-neon transition duration-300">
                        <img src="https://logos-world.net/wp-content/uploads/2020/04/New-Balance-Logo.png" 
                             alt="New Balance" 
                             class="h-12 mx-auto grayscale group-hover:grayscale-0 transition duration-300">
                    </div>
                    <h3 class="text-lg font-bold uppercase mb-2">NEW BALANCE</h3>
                    <p class="text-gray-400 text-sm">Fearlessly Independent</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Newsletter Section -->
    <section class="py-16 bg-gray-100">
        <div class="container mx-auto px-4">
            <div class="max-w-3xl mx-auto text-center">
                <div class="flex items-center justify-center space-x-4 mb-4">
                    <div class="w-12 h-1 bg-neon"></div>
                    <span class="text-micro tracking-mega uppercase text-gray-500">STAY UPDATED</span>
                    <div class="w-12 h-1 bg-neon"></div>
                </div>
                <h2 class="text-4xl md:text-5xl font-black uppercase mb-6">GET THE LATEST<br><span class="text-neon">DROPS & DEALS</span></h2>
                <p class="text-gray-600 mb-8 max-w-xl mx-auto tracking-wider uppercase">
                    Be the first to know about new releases, exclusive collaborations, and special promotions.
                </p>
                <form class="flex flex-col sm:flex-row gap-4 max-w-md mx-auto">
                    <input type="email" 
                           placeholder="YOUR EMAIL ADDRESS" 
                           class="flex-grow px-4 py-3 bg-white border-2 border-black text-black placeholder-gray-500 tracking-wider uppercase focus:outline-none focus:border-neon transition duration-300">
                    <button type="submit" class="bg-black text-white px-6 py-3 font-bold tracking-wider uppercase hover:bg-neon hover:text-black transition duration-300 border-2 border-black">
                        SUBSCRIBE
                    </button>
                </form>
                <p class="text-gray-500 text-sm mt-4 tracking-wider">By subscribing, you agree to our Privacy Policy</p>
            </div>
        </div>
    </section>

    <!-- Footer Container -->
    <div id="footer-container"></div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-4 right-4 bg-black text-white px-6 py-3 rounded-none border-2 border-neon transform translate-x-full transition-transform duration-300 z-50">
        <div class="flex items-center space-x-2">
            <i id="toast-icon" class="fas fa-info-circle text-neon"></i>
            <span id="toast-message" class="text-sm tracking-wider">This is a toast message</span>
        </div>
    </div>

    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/cart.js"></script>
    <script>
        let currentPage = 1;
        let totalPages = 1;
        let filters = {
            search: '',
            brand: [],
            size: [],
            minPrice: 0,
            maxPrice: 50000,
            minRating: 0,
            sort: '-createdAt'
        };

        // Load components
        async function loadComponents() {
            try {
                const navbarResponse = await fetch('components/navbar.html');
                document.getElementById('navbar-container').innerHTML = await navbarResponse.text();
                
                const footerResponse = await fetch('components/footer.html');
                document.getElementById('footer-container').innerHTML = await footerResponse.text();
                
                initializeNavbar();
            } catch (error) {
                console.error('Error loading components:', error);
            }
        }

        function initializeNavbar() {
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            const userDropdownBtn = document.getElementById('user-dropdown-btn');
            const userDropdown = document.getElementById('user-dropdown');

            if (mobileMenuBtn && mobileMenu) {
                mobileMenuBtn.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
            }

            if (userDropdownBtn && userDropdown) {
                userDropdownBtn.addEventListener('click', () => userDropdown.classList.toggle('hidden'));
                document.addEventListener('click', (e) => {
                    if (!userDropdownBtn.contains(e.target) && !userDropdown.contains(e.target)) {
                        userDropdown.classList.add('hidden');
                    }
                });
            }
        }

        // Initialize filters
        function initializeFilters() {
            // Initialize sizes
            const sizes = ['6', '7', '8', '9', '10', '11', '12'];
            const sizesContainer = document.getElementById('sizes-filter');
            sizesContainer.innerHTML = sizes.map(size => `
                <button onclick="toggleSizeFilter('${size}')" 
                        class="size-filter border-2 border-black py-2 text-sm tracking-wider uppercase hover:bg-black hover:text-white transition duration-300 filter-option" 
                        data-size="${size}">
                    ${size}
                </button>
            `).join('');

            // Initialize ratings
            const ratingsContainer = document.getElementById('ratings-filter');
            ratingsContainer.innerHTML = [4, 3, 2, 1].map(rating => `
                <button onclick="toggleRatingFilter(${rating})" 
                        class="rating-filter w-full text-left py-2 px-3 border-2 border-transparent hover:border-black transition duration-300 filter-option" 
                        data-rating="${rating}">
                    <div class="flex items-center space-x-2">
                        ${generateStarRating(rating)}
                        <span class="text-sm tracking-wider uppercase">& UP</span>
                    </div>
                </button>
            `).join('');

            // Initialize price range
            const priceRange = document.getElementById('price-range');
            const maxPrice = document.getElementById('max-price');
            
            priceRange.addEventListener('input', function() {
                filters.maxPrice = parseInt(this.value);
                maxPrice.textContent = this.value;
            });

            // Load brands
            loadBrands();
        }

        // Load brands from API
        async function loadBrands() {
            try {
                // In a real app, you'd fetch from /api/products/brands
                // For now, we'll use mock data
                const brands = ['Nike', 'Adidas', 'Puma', 'New Balance', 'Converse', 'Vans'];
                const brandsContainer = document.getElementById('brands-filter');
                
                brandsContainer.innerHTML = brands.map(brand => `
                    <button onclick="toggleBrandFilter('${brand}')" 
                            class="brand-filter w-full text-left py-2 px-3 border-2 border-transparent hover:border-black transition duration-300 filter-option" 
                            data-brand="${brand}">
                        <span class="text-sm tracking-wider uppercase">${brand}</span>
                    </button>
                `).join('');
            } catch (error) {
                console.error('Error loading brands:', error);
            }
        }

        // Filter functions
        function toggleBrandFilter(brand) {
            const button = document.querySelector(`[data-brand="${brand}"]`);
            if (filters.brand.includes(brand)) {
                filters.brand = filters.brand.filter(b => b !== brand);
                button.classList.remove('bg-black', 'text-white');
                button.classList.add('border-transparent');
            } else {
                filters.brand.push(brand);
                button.classList.add('bg-black', 'text-white');
                button.classList.remove('border-transparent');
            }
            applyFilters();
        }

        function toggleSizeFilter(size) {
            const button = document.querySelector(`[data-size="${size}"]`);
            if (filters.size.includes(size)) {
                filters.size = filters.size.filter(s => s !== size);
                button.classList.remove('bg-black', 'text-white');
            } else {
                filters.size.push(size);
                button.classList.add('bg-black', 'text-white');
            }
            applyFilters();
        }

        function toggleRatingFilter(rating) {
            const button = document.querySelector(`[data-rating="${rating}"]`);
            if (filters.minRating === rating) {
                filters.minRating = 0;
                button.classList.remove('border-black', 'bg-gray-100');
            } else {
                filters.minRating = rating;
                // Remove active state from other rating buttons
                document.querySelectorAll('.rating-filter').forEach(btn => {
                    btn.classList.remove('border-black', 'bg-gray-100');
                });
                button.classList.add('border-black', 'bg-gray-100');
            }
            applyFilters();
        }

        function applyFilters() {
            currentPage = 1;
            filters.search = document.getElementById('search-filter').value;
            filters.sort = document.getElementById('sort-options').value;
            loadProducts();
        }

        function clearFilters() {
            filters = {
                search: '',
                brand: [],
                size: [],
                minPrice: 0,
                maxPrice: 50000,
                minRating: 0,
                sort: '-createdAt'
            };

            // Reset UI
            document.getElementById('search-filter').value = '';
            document.getElementById('price-range').value = 50000;
            document.getElementById('max-price').textContent = '50000';
            document.getElementById('sort-options').value = '-createdAt';

            // Reset filter buttons
            document.querySelectorAll('.brand-filter, .size-filter, .rating-filter').forEach(button => {
                button.classList.remove('bg-black', 'text-white', 'border-black', 'bg-gray-100');
            });

            loadProducts();
        }

        // Load products
        async function loadProducts() {
            try {
                const productsGrid = document.getElementById('products-grid');
                productsGrid.innerHTML = `
                    <div class="loading-pulse bg-gray-200 h-96"></div>
                    <div class="loading-pulse bg-gray-200 h-96"></div>
                    <div class="loading-pulse bg-gray-200 h-96"></div>
                    <div class="loading-pulse bg-gray-200 h-96"></div>
                    <div class="loading-pulse bg-gray-200 h-96"></div>
                    <div class="loading-pulse bg-gray-200 h-96"></div>
                `;

                // Build query parameters
                const params = {
                    page: currentPage,
                    limit: 9,
                    sort: filters.sort
                };

                if (filters.search) params.search = filters.search;
                if (filters.brand.length) params.brand = filters.brand.join(',');
                if (filters.minPrice > 0) params.minPrice = filters.minPrice;
                if (filters.maxPrice < 50000) params.maxPrice = filters.maxPrice;
                if (filters.minRating > 0) params.minRating = filters.minRating;

                const response = await api.getProducts(params);
                const products = response.data.products;
                const pagination = response.data.pagination;

                // Update products count
                document.getElementById('products-count').textContent = 
                    `SHOWING ${products.length} OF ${pagination.total} PRODUCTS`;

                // Update pagination
                currentPage = pagination.current;
                totalPages = pagination.pages;
                updatePagination();

                // Render products
                if (products.length === 0) {
                    productsGrid.innerHTML = `
                        <div class="col-span-3 text-center py-12">
                            <i class="fas fa-search text-6xl text-gray-300 mb-4"></i>
                            <h3 class="text-2xl font-black uppercase mb-2">NO PRODUCTS FOUND</h3>
                            <p class="text-gray-500 tracking-wider uppercase">TRY ADJUSTING YOUR FILTERS</p>
                        </div>
                    `;
                } else {
                    productsGrid.innerHTML = products.map(product => createProductCard(product)).join('');
                }

            } catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('products-grid').innerHTML = `
                    <div class="col-span-3 text-center py-12 text-red-500">
                        <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
                        <p class="tracking-wider uppercase">ERROR LOADING PRODUCTS</p>
                    </div>
                `;
            }
        }

        // Create product card
        function createProductCard(product) {
            const mainImage = product.images?.[0]?.url || 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?ixlib=rb-4.0.3&auto=format&fit=crop&w=1470&q=80';
            const brandName = product.brand?.name || 'Unknown Brand';
            const isInStock = product.variants?.some(v => v.stock > 0) || false;

            return `
                <div class="card-hover group relative bg-white text-black border-2 border-black overflow-hidden hover:border-neon transition duration-300">
                    <div class="relative h-80 overflow-hidden">
                        <img src="${mainImage}"
                             alt="${product.name}"
                             class="w-full h-full object-cover group-hover:scale-110 transition duration-700">

                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-70 transition duration-300 flex items-center justify-center">
                            <a href="product.html?id=${product._id}"
                               class="opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0 transition duration-300 bg-neon text-black px-6 py-3 font-bold tracking-wider uppercase mr-2">
                                VIEW
                            </a>
                            <button onclick="addToCartFromListing('${product._id}')"
                                    class="opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0 transition duration-300 bg-white text-black px-6 py-3 font-bold tracking-wider uppercase ${!isInStock ? 'opacity-50 cursor-not-allowed' : ''}"
                                    ${!isInStock ? 'disabled' : ''}>
                                ${isInStock ? 'ADD TO CART' : 'OUT OF STOCK'}
                            </button>
                        </div>

                        <div class="absolute top-4 left-4 bg-black text-white px-3 py-1">
                            <span class="text-sm font-bold tracking-wider">₹${product.basePrice.toLocaleString()}</span>
                        </div>

                        <div class="absolute top-4 right-4 ${isInStock ? 'bg-neon text-black' : 'bg-red-500 text-white'} px-2 py-1">
                            <span class="text-micro tracking-wider uppercase font-bold">${isInStock ? 'IN STOCK' : 'OUT OF STOCK'}</span>
                        </div>
                    </div>

                    <div class="p-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-micro tracking-wider uppercase text-gray-500">${product.category?.name || 'Uncategorized'}</span>
                            <span class="text-micro tracking-wider uppercase text-neon">${brandName}</span>
                        </div>

                        <h3 class="text-lg font-bold uppercase tracking-wide mb-2 leading-tight">${product.name}</h3>

                        <p class="text-gray-600 text-sm mb-4 line-clamp-2">${product.description}</p>

                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-1">
                                ${generateStarRating(product.rating?.average || 0)}
                                <span class="text-micro tracking-wider text-gray-500">(${product.rating?.count || 0})</span>
                            </div>
                            <a href="product.html?id=${product._id}"
                               class="text-black text-sm tracking-wider uppercase hover:text-neon transition duration-300 border-b border-transparent hover:border-neon">
                                DETAILS →
                            </a>
                        </div>
                    </div>
                </div>
            `;
        }

        // Generate star rating
        function generateStarRating(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    stars += '<i class="fas fa-star text-neon text-xs"></i>';
                } else if (i - 0.5 <= rating) {
                    stars += '<i class="fas fa-star-half-alt text-neon text-xs"></i>';
                } else {
                    stars += '<i class="far fa-star text-gray-300 text-xs"></i>';
                }
            }
            return stars;
        }

        // Add to cart from products listing
        async function addToCartFromListing(productId) {
            try {
                if (!isLoggedIn()) {
                    showToast('Please login to add items to cart', 'warning');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 1500);
                    return;
                }

                const productResponse = await api.getProduct(productId);
                const product = productResponse.data.product;
                const firstVariant = product.variants?.[0];

                if (!firstVariant) {
                    showToast('No variants available', 'error');
                    return;
                }

                const cartData = {
                    productId: productId,
                    variant: {
                        size: firstVariant.size,
                        color: firstVariant.color,
                        sku: firstVariant.sku
                    },
                    quantity: 1
                };

                await api.addToCart(cartData);
                showToast('Product added to cart', 'success');
                updateCartCount();

            } catch (error) {
                console.error('Error adding to cart:', error);
                showToast(error.message || 'Error adding to cart', 'error');
            }
        }

        // Pagination functions
        function updatePagination() {
            const paginationContainer = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }

            let paginationHTML = '';

            // Previous button
            if (currentPage > 1) {
                paginationHTML += `
                    <button onclick="goToPage(${currentPage - 1})" 
                            class="border-2 border-black px-4 py-2 text-sm tracking-wider uppercase hover:bg-black hover:text-white transition duration-300">
                        <i class="fas fa-chevron-left mr-2"></i>PREV
                    </button>
                `;
            }

            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === currentPage) {
                    paginationHTML += `
                        <button class="bg-black text-white px-4 py-2 text-sm tracking-wider uppercase border-2 border-black">
                            ${i}
                        </button>
                    `;
                } else if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                    paginationHTML += `
                        <button onclick="goToPage(${i})" 
                                class="border-2 border-black px-4 py-2 text-sm tracking-wider uppercase hover:bg-black hover:text-white transition duration-300">
                            ${i}
                        </button>
                    `;
                } else if (i === currentPage - 2 || i === currentPage + 2) {
                    paginationHTML += `<span class="px-2 text-gray-500">...</span>`;
                }
            }

            // Next button
            if (currentPage < totalPages) {
                paginationHTML += `
                    <button onclick="goToPage(${currentPage + 1})" 
                            class="border-2 border-black px-4 py-2 text-sm tracking-wider uppercase hover:bg-black hover:text-white transition duration-300">
                        NEXT<i class="fas fa-chevron-right ml-2"></i>
                    </button>
                `;
            }

            paginationContainer.innerHTML = paginationHTML;
        }

        function goToPage(page) {
            currentPage = page;
            loadProducts();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadComponents().then(() => {
                checkAuthStatus();
                updateCartCount();
                initializeFilters();
                loadProducts();
                
                // Load URL parameters
                const urlParams = new URLSearchParams(window.location.search);
                const searchParam = urlParams.get('search');
                if (searchParam) {
                    document.getElementById('search-filter').value = searchParam;
                    filters.search = searchParam;
                    applyFilters();
                }
            });
        });
    </script>
</body>
</html>